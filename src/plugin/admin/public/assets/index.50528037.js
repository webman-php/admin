var f=(t,d,n)=>new Promise((a,c)=>{var m=o=>{try{r(n.next(o))}catch(s){c(s)}},p=o=>{try{r(n.throw(o))}catch(s){c(s)}},r=o=>o.done?a(o.value):Promise.resolve(o.value).then(m,p);r((n=n.apply(t,d)).next())});import{B as x,u as A}from"./useTable.1f9e9a8e.js";import{x as E}from"./BasicForm.82e222ab.js";import{a as F,b as $,g as S}from"./common.4f9a0f43.js";import{b as U}from"./index.a4e346ff.js";import O from"./Update.339ad87a.js";import{aJ as N,r as w,a as D,cF as H,ac as V,aL as h,o as j,h as q,j as b,p as g,q as G,cy as C,x as J}from"./index.f8bcf808.js";import{t as K}from"./util.85659bac.js";import"./index.d82b2be8.js";import"./useForm.15b4451f.js";import"./index.d4c4849e.js";import"./index.40c44490.js";import"./index.060f9061.js";import"./index.0e7d1863.js";import"./index.8cf0b441.js";import"./useWindowSizeFn.d2a0a89b.js";import"./useContentViewHeight.0d100a60.js";import"./ArrowLeftOutlined.73a6b26e.js";import"./transButton.ce0379fb.js";import"./index.05080ca7.js";import"./index.b5bef3a7.js";import"./_baseIteratee.f49fbaac.js";import"./index.91cad2d2.js";import"./sortable.esm.c20789c1.js";import"./RedoOutlined.ed3d1686.js";import"./FullscreenOutlined.f88b6f65.js";import"./fromPairs.2341303e.js";import"./scrollTo.d51d60f9.js";import"./index.fe83b607.js";import"./index.bf9f5082.js";import"./index.14ba2351.js";import"./index.293b5840.js";import"./index.26a767f7.js";import"./uniqBy.0ae55b98.js";import"./download.b66616ed.js";import"./index.f2e779e6.js";const y="/app/admin/auth/adminrule/select",M="/app/admin/auth/adminrule/insert",R="/app/admin/auth/adminrule/update",L="/app/admin/auth/adminrule/delete",T="/app/admin/auth/adminrule/schema",l=w({schemas:[]}),z=D({components:{ModalInserOrEdit:O,BasicTable:x,TableAction:E},setup(){const{createMessage:t}=J(),{success:d}=t,n=w([]),a=w("");H(()=>f(this,null,function*(){const i=yield F(T),B=i.columns;for(let e of B)if(e.primary_key){a.value=e.field;break}const I=i.forms;l.value.schemas=[];for(let e of I){if(e.searchable){let[_,v]=K(e,"","search");e.search_type=="between"?(l.value.schemas.push({field:`${e.field}[0]`,component:_,label:e.comment||e.field,colProps:{offset:1,span:5},componentProps:v}),l.value.schemas.push({field:`${e.field}[1]`,component:_,label:"\u3000\u5230",colProps:{span:5},componentProps:v})):l.value.schemas.push({field:e.field,component:_,label:e.comment||e.field,colProps:{offset:1,span:10},componentProps:v})}let k={dataIndex:e.field,title:e.comment||e.field,sorter:e.enable_sort,defaultHidden:!e.list_show};["InputNumber","Switch"].indexOf(e.control)!=-1&&(k.width=120),n.value.push(k)}l.value.schemas.length||V(()=>{o({useSearchForm:!1})})}));const[c,{openModal:m}]=U(),[p,{reload:r,setProps:o}]=A({api:S(y,{format:"table_tree"}),columns:n,useSearchForm:!0,bordered:!0,isTreeTable:!0,formConfig:l,pagination:!1,actionColumn:{width:250,title:"Action",dataIndex:"action",slots:{customRender:"action"}}});function s(i){return f(this,null,function*(){if(!a.value){C("The current table has no primary key and cannot be edited");return}m(!0,{selectUrl:y,insertUrl:M,updateUrl:R,schemaUrl:T,column:a.value,value:i[a.value]})})}function u(i){return f(this,null,function*(){if(!a.value){C("The current table has no primary key and cannot be deleted");return}yield $(L,{column:a.value,value:i[a.value]}),d("successfully deleted"),r()})}function P(){m(!0,{selectUrl:y,insertUrl:M,updateUrl:R,schemaUrl:T})}return{registerTable:p,handleEdit:s,handleDelete:u,openRowModal:P,register:c,reload:r}}}),Q={class:"p-4"};function W(t,d,n,a,c,m){const p=h("a-button"),r=h("TableAction"),o=h("BasicTable"),s=h("ModalInserOrEdit");return j(),q("div",Q,[b(o,{onRegister:t.registerTable,showTableSetting:""},{toolbar:g(()=>[b(p,{type:"primary",onClick:t.openRowModal},{default:g(()=>[G(" Add record ")]),_:1},8,["onClick"])]),action:g(({record:u})=>[b(r,{actions:[{label:"edit",onClick:t.handleEdit.bind(null,u)},{label:"delete",icon:"ic:outline-delete-outline",popConfirm:{title:"delete or not\uFF1F",confirm:t.handleDelete.bind(null,u)}}]},null,8,["actions"])]),_:1},8,["onRegister"]),b(s,{onRegister:t.register,minHeight:300,onReload:t.reload},null,8,["onRegister","onReload"])])}var Fe=N(z,[["render",W]]);export{Fe as default};
