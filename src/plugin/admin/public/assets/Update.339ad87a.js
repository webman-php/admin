var h=(r,p,a)=>new Promise((d,n)=>{var c=l=>{try{i(a.next(l))}catch(m){n(m)}},e=l=>{try{i(a.throw(l))}catch(m){n(m)}},i=l=>l.done?d(l.value):Promise.resolve(l.value).then(c,e);i((a=a.apply(r,p)).next())});import{B as A}from"./BasicForm.82e222ab.js";import{B as G,a as N}from"./index.a4e346ff.js";import{aJ as j,r as s,a as q,aL as M,o as J,aM as L,p as T,i as W,j as x,b8 as z,x as D}from"./index.f8bcf808.js";import{a as U,b as y}from"./common.4f9a0f43.js";import{t as H}from"./util.85659bac.js";import"./index.14ba2351.js";import"./index.0e7d1863.js";import"./_baseIteratee.f49fbaac.js";import"./index.91cad2d2.js";import"./index.d82b2be8.js";import"./index.8cf0b441.js";import"./index.05080ca7.js";import"./index.b5bef3a7.js";import"./index.293b5840.js";import"./index.26a767f7.js";import"./uniqBy.0ae55b98.js";import"./download.b66616ed.js";import"./index.f2e779e6.js";import"./useWindowSizeFn.d2a0a89b.js";import"./FullscreenOutlined.f88b6f65.js";const b=s(null),S=s(""),C=s(""),E=s(""),k=s(""),K=q({components:{BasicForm:A,BasicModal:G},emits:["reload","register"],setup(r,{emit:p}){const a=s("Add record"),d=s(""),n=s(""),c=s(""),e=s("insert"),i=[],[l,{closeModal:m}]=N(t=>h(this,null,function*(){n.value=t.column,c.value=t.value,d.value=t.table,S.value=t.selectUrl,C.value=t.insertUrl,E.value=t.updateUrl,k.value=t.schemaUrl,n.value?(e.value="edit",a.value="Edit record"):(e.value="insert",a.value="insert record");const u=yield U(k.value),F=u.forms,O=u.columns,f={};for(let o of O)f[o.field]=o;const v=b.value;if(!v)return;yield v.resetSchema([]);const w={};w[n.value]=c.value;const B=e.value=="edit"?yield U(S.value,w):{},R=e.value=="edit"&&B.items.length?B.items[0]:{};for(let o of F){if(!o.form_show)continue;let I=e.value=="edit"?R[o.field]:f[o.field].default,[V,_,g]=H(o,I,e.value);o.field=="password"&&(g="",e.value=="edit"&&(_={placeholder:"Please leave blank to not update password"})),v.appendSchemaByField({field:o.field,component:V,label:o.comment||o.field,colProps:{span:24},required:e.value=="edit"&&o.field=="password"?!1:!f[o.field].nullable,componentProps:_,defaultValue:g},"")}})),{createMessage:P}=D(),{success:$}=P;return{formElRef:b,handleSubmit:()=>h(this,null,function*(){try{const t=b.value;if(!t)return;const u=yield t.validate();e.value=="edit"?yield y(E.value,{column:n.value,value:c.value,data:u}):yield y(C.value,{data:u}),m(),$("Successful operation"),p("reload")}catch(t){console.log(t)}}),schemas:i,register:l,title:a}}}),Q={class:"mt-3"};function X(r,p,a,d,n,c){const e=M("BasicForm"),i=M("BasicModal");return J(),L(i,z(r.$attrs,{destroyOnClose:"",onRegister:r.register,title:r.title,onOk:r.handleSubmit}),{default:T(()=>[W("div",Q,[x(e,{schemas:r.schemas,ref:"formElRef",labelWidth:75,showActionButtonGroup:!1},null,8,["schemas"])])]),_:1},16,["onRegister","title","onOk"])}var _e=j(K,[["render",X]]);export{_e as default};
