var k=(x,d,r)=>new Promise((c,f)=>{var t=o=>{try{i(r.next(o))}catch(u){f(u)}},y=o=>{try{i(r.throw(o))}catch(u){f(u)}},i=o=>o.done?c(o.value):Promise.resolve(o.value).then(t,y);i((r=r.apply(x,d)).next())});import{a as T,I as w,c as N,b as U,l as z,r as v,m as E,f as V,k as e,o as $,h as K,w as I,v as b,j as a,p as n,i as M,B as j,q,t as A,s as P,F as G,x as O}from"./index.f8bcf808.js";import{F as L}from"./index.14ba2351.js";import"./index.0e7d1863.js";import H from"./LoginFormTitle.4c1672da.js";import{u as J,a as Q,L as W,b as X}from"./useLogin.7cc7f83b.js";import"./index.26a767f7.js";import{C as Y,R as Z}from"./index.f2e779e6.js";import"./_baseIteratee.f49fbaac.js";const ee=["src"],ue=T({__name:"LoginForm",setup(x){const d=Y,r=Z,c=L.Item,f=w.Password,{t}=N(),{notification:y,createErrorModal:i}=O(),{prefixCls:o}=U("login"),u=z(),{getLoginState:R}=J(),{getFormRules:B}=Q(),_=v(),h=v(!1),S=v(""),l=E({account:"",password:"",captcha:""}),{validForm:D}=X(_),C=V(()=>e(R)===W.LOGIN);function g(){S.value="/app/admin/common/account/captcha?r="+new Date().getTime()}g();function F(){return k(this,null,function*(){const p=yield D();if(!!p)try{h.value=!0;const s=yield u.login({password:p.password,username:p.account,captcha:p.captcha,mode:"none"});s?y.success({message:t("sys.login.loginSuccessTitle"),description:`${t("sys.login.loginSuccessDesc")}: ${s.nickname}`,duration:3}):g()}catch(s){setTimeout(()=>{g()},2e3),i({title:t("sys.api.errorTip"),content:s.message||t("sys.api.networkExceptionMsg"),getContainer:()=>document.body.querySelector(`.${o}`)||document.body})}finally{h.value=!1}})}return(p,s)=>($(),K(G,null,[I(a(H,{class:"enter-x"},null,512),[[b,e(C)]]),I(a(e(L),{class:"p-4 enter-x",model:l,rules:e(B),ref_key:"formRef",ref:_,onKeypress:P(F,["enter"])},{default:n(()=>[a(e(c),{name:"account",class:"enter-x"},{default:n(()=>[a(e(w),{size:"large",value:l.account,"onUpdate:value":s[0]||(s[0]=m=>l.account=m),placeholder:e(t)("sys.login.userName"),class:"fix-auto-fill"},null,8,["value","placeholder"])]),_:1}),a(e(c),{name:"password",class:"enter-x"},{default:n(()=>[a(e(f),{size:"large",visibilityToggle:"",value:l.password,"onUpdate:value":s[1]||(s[1]=m=>l.password=m),placeholder:e(t)("sys.login.password")},null,8,["value","placeholder"])]),_:1}),a(e(c),{name:"captcha",class:"enter-x"},{default:n(()=>[a(e(r),{type:"flex",justify:"space-between",align:"middle"},{default:n(()=>[a(e(d),null,{default:n(()=>[a(e(w),{size:"large",value:l.captcha,"onUpdate:value":s[2]||(s[2]=m=>l.captcha=m),placeholder:e(t)("sys.login.captcha"),class:"fix-auto-fill captcha-input",maxlength:5},null,8,["value","placeholder"])]),_:1}),a(e(d),null,{default:n(()=>[M("img",{src:S.value,onClick:g},null,8,ee)]),_:1})]),_:1})]),_:1}),a(e(c),{class:"enter-x"},{default:n(()=>[a(e(j),{type:"primary",size:"large",block:"",onClick:F,loading:h.value},{default:n(()=>[q(A(e(t)("sys.login.loginButton")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules","onKeypress"]),[[b,e(C)]])],64))}});export{ue as default};
